<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Объектно-ориентированный JavaScript: немного практики | Frontend Raccoon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="В прошлых статьях мы рассмотрели основы работы с объектами, функции конструкторы и прототипы. А, значит, настало время окончательно во всём разобраться и написать боевой пример — небольшую библиотеку">
<meta property="og:type" content="article">
<meta property="og:title" content="Объектно-ориентированный JavaScript: немного практики">
<meta property="og:url" content="http://jsraccon.github.io/oop-example-validation/index.html">
<meta property="og:site_name" content="Frontend Raccoon">
<meta property="og:description" content="В прошлых статьях мы рассмотрели основы работы с объектами, функции конструкторы и прототипы. А, значит, настало время окончательно во всём разобраться и написать боевой пример — небольшую библиотеку">
<meta property="og:updated_time" content="2016-05-23T13:40:45.797Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Объектно-ориентированный JavaScript: немного практики">
<meta name="twitter:description" content="В прошлых статьях мы рассмотрели основы работы с объектами, функции конструкторы и прототипы. А, значит, настало время окончательно во всём разобраться и написать боевой пример — небольшую библиотеку">
  
    <link rel="alternate" href="/atom.xml" title="Frontend Raccoon" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href='https://fonts.googleapis.com/css?family=Arimo:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin,cyrillic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" media="screen" title="no title" charset="utf-8">
  <link rel="stylesheet" href="/website/css/style.css">
  

</head>

<body>

  <section class="wrapper grid-noGutter">
    <main class="col-9_md-8_sm-12">
      <article id="post-oop-example-validation" class="article" itemscope itemprop="blogPost">
  <header class="article__header">
    <h2 class="article__title" itemprop="name">
  <a class="article__link" href="/website/oop-example-validation/">Объектно-ориентированный JavaScript: немного практики</a>
</h2>

    <div class="article__meta">
      <a href="/website/oop-example-validation/" class="article__link">
  <i class="fa fa-calendar-o"></i>
  <time datetime="2016-04-23T00:00:00.000Z" itemprop="datePublished">
    23 Апреля 2016 г.
  </time>
</a>

      <a class="article__link" href="#0">
  <i class="fa fa-pencil article__icon"></i>

  Виталий Ртищев
</a>

    </div>
  </header>

  <div class="article__body">
    <div class="article__content">
      
        <p>В прошлых статьях мы рассмотрели <a href="http://jsraccoon.ru/oop-object-base" target="_blank" rel="external">основы работы с объектами</a>, <a href="http://jsraccoon.ru/oop-constructors" target="_blank" rel="external">функции конструкторы</a> и <a href="http://jsraccoon.ru/oop-prototypes" target="_blank" rel="external">прототипы</a>. А, значит, настало время окончательно во всём разобраться и написать боевой пример — небольшую библиотеку для валидации данных. Полный код библиотеки, которую будем создавать в этой статье, можно найти в <a href="https://github.com/rtivital/validate" target="_blank" rel="external">этом репозитории</a>. Если же вы хотите в ходе чтения статьи следовать всем инструкциям, то вы можете скачать <a href="https://gist.github.com/rtivital/229191009ff742df62bd" target="_blank" rel="external">стартовый шаблон</a>.<br><a id="more"></a></p>
<h5 id="Идея"><a href="#Идея" class="headerlink" title="Идея"></a>Идея</h5><p>Библиотека предназначена для валидации данных из одного поля ввода (тега <code>&lt;input&gt;</code> или <code>&lt;textarea&gt;</code>) и предоставляет несколько простых методов проверки данных. Например, можно проверить правильность введённого email адреса или указать максимальное и минимальное количество символов. Сама по себе, библиотека не даёт огромного функционала, но очень проста в расширении, предлагая пользователю самому дописать необходимые ему методы для валидации данных. В комплекте с библиотекой идёт простой строковый шаблонизатор, который поможет выводить понятные сообщения об ошибках.</p>
<h5 id="Параметры"><a href="#Параметры" class="headerlink" title="Параметры"></a>Параметры</h5><p>Необходимо всегда точно осознавать, что будет делать созданная вами функция-конструктор перед тем, как вы начнёте писать код. Поэтому, для начала, попробуем описать, что будет делать валидатор данных. Мы уже знаем, что нам обязательно нужно передавать DOM элемент (<code>&lt;input&gt;</code> или <code>&lt;textarea&gt;</code>), но помимо этого нам также необходимо узнать правила валидации, шаблоны сообщений об ошибках и <code>callback</code> функции, которые будут срабатывать при успешном или, наоборот, неуспешном завершении валидации. Очевидно, что параметров достаточно много и передавать их в функцию по одному будет крайне неудобно. Как раз для таких целей и существуют объекты. Используя объект, мы можем удобно сгруппировать все передаваемые в функцию данные. Таким образом, все параметры, которые нужно предоставить функции-конструктору: DOM элемент и объект настроек.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> email = <span class="built_in">document</span>.getElementbyId(<span class="string">'email'</span>);</span><br><span class="line"><span class="keyword">var</span> emailValidation = <span class="keyword">new</span> Validator(email, &#123; <span class="comment">/* объект настроек */</span> &#125;);</span><br></pre></td></tr></table></figure></p>
<h5 id="Объект-настроек"><a href="#Объект-настроек" class="headerlink" title="Объект настроек"></a>Объект настроек</h5><p>Итак, у нас уже есть поле ввода, данные из которого будут проверяться, но этого же недостаточно. По крайней мере, нужно указать правила, в соответствие с которыми будет проводиться валидация. Для этого создадим свойство <code>rules</code> в объекте настроек, которое будет содержать все правила:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> settings = &#123;</span><br><span class="line">  rules: &#123;</span><br><span class="line">    min: <span class="number">8</span>,</span><br><span class="line">    max: <span class="number">50</span>,</span><br><span class="line">    match: <span class="string">'email'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>Данная конфигурация скажет функции-конструктору, что поле ввода должно содержать валидный адрес электронной почты, длина которого не меньше 8 и не больше 50 символов.</p>
<p>К каждому правилу должно прилагаться сообщение об ошибке, которое будет использовано, когда валидация данных будет провалена. Поэтому создадим ещё одно свойство объекта <code>settings</code>, которое будет содержать все сообщения об ошибках.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> settings = &#123;</span><br><span class="line">  rules: &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">  messages: &#123;</span><br><span class="line">    min: <span class="string">'Поле должно содержать больше 8 символов'</span>,</span><br><span class="line">    max: <span class="string">'Поле не должно содержать больше 50 символов'</span>,</span><br><span class="line">    match: <span class="string">'Поле должно содержать валидный адрес электронной почты'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>Теперь остался последний, но самый важный шаг для завершения конфигурации — <code>callback</code> функции. Для наглядности назовём их <code>onError</code> и <code>onSuccess</code>. Данные функции, передаваемые с объектом настроек, будут срабатывать при завершении валидации в зависимости от её результата. Они могут содержать всё что угодно, но пока для простоты будем просто выводить в консоль сообщения.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> settings = &#123;</span><br><span class="line">  rules: &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">  messages: &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">  onError: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'Валидация провалена'</span>); &#125;,</span><br><span class="line">  onSuccess: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'Валидация прошла успешно'</span>); &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>Итак, основа нашего объекта настроек готова, и мы уже определились со всеми параметрами, передаваемыми в функцию, а, значит, половина работы мы уже сделали.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> settings = &#123;</span><br><span class="line">  rules: &#123;</span><br><span class="line">    min: <span class="number">8</span>,</span><br><span class="line">    max: <span class="number">50</span>,</span><br><span class="line">    match: <span class="string">'email'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  messages: &#123;</span><br><span class="line">    min: <span class="string">'Поле должно содержать больше 8 символов'</span>,</span><br><span class="line">    max: <span class="string">'Поле не должно содержать больше 50 символов'</span>,</span><br><span class="line">    match: <span class="string">'Поле должно содержать валидный адрес электронной почты'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  onError: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'Валидация провалена'</span>); &#125;,</span><br><span class="line">  onSuccess: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'Валидация прошла успешно'</span>); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> email = <span class="built_in">document</span>.getElementbyId(<span class="string">'email'</span>);</span><br><span class="line"><span class="keyword">var</span> emailValidation = <span class="keyword">new</span> Validator(email, settings);</span><br></pre></td></tr></table></figure></p>
<h5 id="Паттерн-“Модуль”"><a href="#Паттерн-“Модуль”" class="headerlink" title="Паттерн “Модуль”"></a>Паттерн “Модуль”</h5><p>При создании библиотеки мы не хотим, чтобы все наши “внутренние” переменные попали в чужие руки (кто знает, что задумали другие разработчики-злодеи). Может возникнуть конфликт имён и любую переменную из нашей библиотеки сможет перезаписать сторонний код. Чтобы этого не произошло, необходимо ограничить доступ. Удобнее всего это сделать с помощью <a href="http://forwebdev.ru/javascript/module-pattern/" target="_blank" rel="external">паттерна “Модуль”</a>. Всё, что для этого нужно, — обвернуть весь наш код в немедленно вызываемую анонимную функцию и записать результат её выполнения в переменную, которая и будет использоваться другими разработчиками.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Validator = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;)();</span><br></pre></td></tr></table></figure></p>
<p>Таким образом, мы создали новую область видимости. Всё, что находится внутри неё, не будет доступно для записи и чтения, если мы сами не запишем данные, как свойство объекта <code>window</code>, или не вернём значение — в этом случае то, что возвращает функция будет записано в переменную <code>Validator</code>. Создадим функцию-конструктор и экспортируем её из модуля:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Validator = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Validate = <span class="function"><span class="keyword">function</span>(<span class="params">element, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.element = element;</span><br><span class="line">    <span class="keyword">this</span>.options = options;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Validate;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p>
<p>Теперь у нас есть возможность использовать функцию <code>Validate</code> вне модуля, так как она была записана в переменную <code>Validator</code>.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> emailValidation = <span class="keyword">new</span> Validator(<span class="string">'element'</span>, <span class="string">'options'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(emailValidation); <span class="comment">// &#123; element: "element", options: "options" &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>Как я уже писал выше, мы также можем записать любые данные, как свойство объекта <code>window</code>. При подобной подходе у нас уже не возникает необходимости возвращать что-либо из модуля. Поэтому и результат выполнения записывать в переменную нет необходимости.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Validate = <span class="function"><span class="keyword">function</span>(<span class="params">element, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.element = element;</span><br><span class="line">    <span class="keyword">this</span>.options = options;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.Validator = Validate;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p>
<h5 id="Запись-свойств"><a href="#Запись-свойств" class="headerlink" title="Запись свойств"></a>Запись свойств</h5><p>Мы уже приступили к созданию функции-конструктора <code>Validate</code> и записали два свойства: <code>element</code> и <code>options</code>. Этого вполне достаточно, но было бы удобно обращаться к некоторым свойствам напрямую, например, писать каждый раз не <code>this.options.rules</code>, а просто <code>this.rules</code>. Поэтому создадим ещё несколько свойств для удобства:</p>
<ul>
<li><code>value</code> для обращения к введенным в поле ввода данным</li>
<li><code>length</code> — количество символов в полученном <code>value</code></li>
<li><code>rules</code> — объект, содержащий все правила</li>
<li>и <code>messages</code> — объект со всеми сообщениями</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Validate = <span class="function"><span class="keyword">function</span>(<span class="params">element, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.element = element;</span><br><span class="line">  <span class="keyword">this</span>.options = options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.value = <span class="keyword">this</span>.element.value.trim();</span><br><span class="line">  <span class="keyword">this</span>.length = <span class="keyword">this</span>.value.length;</span><br><span class="line">  <span class="keyword">this</span>.rules = <span class="keyword">this</span>.options.rules;</span><br><span class="line">  <span class="keyword">this</span>.mesages = <span class="keyword">this</span>.options.messages;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="Методы"><a href="#Методы" class="headerlink" title="Методы"></a>Методы</h5><p>В начале статьи я писал, что библиотека достаточно минималистична и не располагает огромным количеством методов. Поэтому ограничимся самым минимальным набором:</p>
<ul>
<li><code>required</code> — проверка наличия хотя бы одного непробельного символа</li>
<li><code>min</code> — минимальное количество символов</li>
<li><code>max</code> — максимальное количество символов</li>
<li><code>match</code> — проверка соответствия какому-либо паттерну</li>
</ul>
<h5 id="required"><a href="#required" class="headerlink" title="required"></a>required</h5><p>Всё, что необходимо сделать в методе — сравнить длину значения <code>this.length</code> с нулём. Таким, образом мы убедимся, что был введён хотя бы один непробельный символ:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Validate.prototype.required = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.length &gt; <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="min-и-max"><a href="#min-и-max" class="headerlink" title="min и max"></a>min и max</h5><p>Методы <code>min</code> и <code>max</code> практически повторяют метод <code>required</code>, но также принимают параметр, с которым будут сравнивать длину полученного значения <code>this.length</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Validate.prototype.min = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.length &gt;= param;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Validate.prototype.max = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.length &lt;= param;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="match"><a href="#match" class="headerlink" title="match"></a>match</h5><p>Метод <code>match</code> работает с регулярными выражениями. Для простоты создадим объект, который будет содержать все наши регулярные выражения. Положим его в переменную <code>regExps</code> и объявим её вне метода.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> regExps = &#123;</span><br><span class="line">  email: <span class="regexp">/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]&#123;0,66&#125;)\.([a-z]&#123;2,6&#125;(?:\.[a-z]&#123;2&#125;)?)$/i</span>,</span><br><span class="line">  url: <span class="regexp">/^((https?):\/\/(\w+:&#123;0,1&#125;\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&amp;%@!\-\/]))?$/</span>,</span><br><span class="line">  numbers: <span class="regexp">/^\d+(\.\d&#123;1,2&#125;)?$/</span>,</span><br><span class="line">  digits: <span class="regexp">/[0-9]*$/</span>,</span><br><span class="line">  letters: <span class="regexp">/[a-z][A-Z]*$/</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Validate.prototype.match = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure></p>
<p>Теперь мы сможем получить к ним доступ внутри метода <code>match</code>. В будущем нам ещё понадобится этот объект, так что поместить его вне метода <code>match</code> — хорошая идея.<br>Чтобы проверить соответствие значения <code>this.value</code> регулярному выражению нужно воспользоваться методом <code>test</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Validate.prototype.match = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// выбираем регулярное выражение</span></span><br><span class="line">  <span class="keyword">var</span> re = regExps[param];</span><br><span class="line">  <span class="comment">// Тестируем</span></span><br><span class="line">  <span class="keyword">return</span> re.test(<span class="keyword">this</span>.value);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Кратко</span></span><br><span class="line">Validate.prototype.match = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> regExps[param].test(<span class="keyword">this</span>.value);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="Всё-вместе"><a href="#Всё-вместе" class="headerlink" title="Всё вместе"></a>Всё вместе</h5><p>Итак, мы написали 4 метода для валидации данных:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Validate.prototype.required = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.length &gt; <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Validate.prototype.min = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.length &gt;= param;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Validate.prototype.max = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.length &lt;= param;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Validate.prototype.match = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> regExps[param].test(<span class="keyword">this</span>.value);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>Для их создания нам каждый раз приходилось обращаться к прототипу функции-конструктора <code>Validate</code>. Запись <code>Validate.prototype</code> достаточно громоздкая. Чтобы каждый раз не использовать её можно создать переменную, которая будет ссылаться на прототип. Так как любой прототип является не более чем простым объектом, мы можем смело задавать подобные переменные:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn = Validate.prototype;</span><br><span class="line">fn.required = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.length &gt; <span class="number">0</span>; &#125;;</span><br><span class="line">fn.min = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.length &gt;= param; &#125;;</span><br><span class="line">fn.max = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.length &lt;= param; &#125;;</span><br><span class="line">fn.match = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123; <span class="keyword">return</span> regExps[param].test(<span class="keyword">this</span>.value); &#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="Валидация"><a href="#Валидация" class="headerlink" title="Валидация"></a>Валидация</h5><p>Сами по себе написанные нами ранее методы бесполезны. Они ничего не умеют, кроме проверки данных. То есть для создания сообщений, группировки этих методов и вызова <code>callback</code> функций они не подходят. Поэтому создадим ещё один метод <code>validate</code>, который будет отвечать за обработку всего выше перечисленного.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fn.validate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure></p>
<p>Первое, что нужно сделать — перезаписать значение для <code>this.value</code> и <code>this.length</code>. При каждом запуске метода <code>validate</code> мы хотим получать новые данные из поля ввода и только потом проверять их.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn.validate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.value = <span class="keyword">this</span>.element.value.trim();</span><br><span class="line">  <span class="keyword">this</span>.length = <span class="keyword">this</span>.value.length;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>Теперь у нас есть самые “свежие” данные и мы можем их использовать для проверки соответствия правилам, которые записаны в объекте <code>this.rules</code>. Свойства объекта <code>this.rules</code> соответствуют написанным нами ранее методам. Удобнее всего правила перебрать с помощью цикла <code>for .. in</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Пример объекта правил</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   min: 8,</span></span><br><span class="line"><span class="comment">//   max: 50,</span></span><br><span class="line"><span class="comment">//   match: 'email'</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">fn.validate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.value = <span class="keyword">this</span>.element.value.trim();</span><br><span class="line">  <span class="keyword">this</span>.length = <span class="keyword">this</span>.value.length;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> rule <span class="keyword">in</span> <span class="keyword">this</span>.rules) &#123;</span><br><span class="line">    <span class="keyword">var</span> param = <span class="keyword">this</span>.rules[rule];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>Итак, мы написали цикл, с помощью которого мы переберём все передаваемые в функцию правила. При каждой итерации внутри цикла у нас будет доступ к имени текущего правила, например, <code>min</code>, а также к параметру правила, например <code>8</code> для правила <code>min</code>. Всё, что нам остаётся сделать, — последовательно применить созданные нам ранее методы.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn.validate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> rule <span class="keyword">in</span> <span class="keyword">this</span>.rules) &#123;</span><br><span class="line">    <span class="keyword">var</span> param = <span class="keyword">this</span>.rules[rule];</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">this</span>[rule](param);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>Переменная <code>result</code> всегда содержит значение типа <code>boolean</code>, с помощью которого мы можем сказать соответствует ли наше <code>this.value</code> требованиям, описанным в правилах. Если мы узнали, что значение не соответствует какому-либо правилу, то мы сразу же прерываем выполнение цикла и вызываем <code>callback</code> функцию <code>onError</code>. Если же значение прошло проверки на все заданные правила, то нужно вызвать функцию <code>onSuccess</code>. Перед циклом объявим переменную <code>isValid</code>, которая будет сигнализировать о состоянии валидации.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fn.validate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// Изначально считаем, что все правила пройдены</span></span><br><span class="line">  <span class="keyword">var</span> isValid = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> rule <span class="keyword">in</span> <span class="keyword">this</span>.rules) &#123;</span><br><span class="line">    <span class="keyword">var</span> param = <span class="keyword">this</span>.rules[rule];</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">this</span>[rule](param);</span><br><span class="line">    <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">      <span class="comment">// Если вылидация провалилась, то выставляем значение false</span></span><br><span class="line">      isValid = <span class="literal">false</span>;</span><br><span class="line">      <span class="comment">// Вызываем функцию onError</span></span><br><span class="line">      <span class="keyword">this</span>.options.onError.call(<span class="keyword">this</span>);</span><br><span class="line">      <span class="comment">// И прерываем выполнение цикла</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// После завершения цикла проверяем isValid</span></span><br><span class="line">  <span class="keyword">if</span> (isValid) &#123;</span><br><span class="line">    <span class="comment">// Если всё хорошо, то вызываем функцию onSuccess</span></span><br><span class="line">    <span class="keyword">this</span>.options.onSuccess.call(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="Пишем-сообщения"><a href="#Пишем-сообщения" class="headerlink" title="Пишем сообщения"></a>Пишем сообщения</h5><p>Написанный нами метод <code>validate</code> уже сейчас достаточно хорошо. Он умеет проверять соответствие данных всем переданным правилам и вызывать функции в зависимости от результата проверки. Но мы также хотим передавать содержательные сообщения о полученных ошибках. В этом нам поможет простая функция для строковой шаблонизации. Допустим, что на выходе мы хотим получить сообщение, которое будет содержать введённые пользователем данные, а также параметр из наших правил. Чтобы получить подобную конструкцию мы можем составить строку:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rules = &#123;</span><br><span class="line">  min: <span class="number">8</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> messages = &#123;</span><br><span class="line">  min: <span class="string">'Значение должно быть не менее %rule% символов. Значение "%data%" не подходит.'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>В полученной строке необходимо заменить <code>%rule%</code> на параметр (в данном случае 8), а <code>%data%</code> на значение, полученное от пользователя. Таким образом, со всеми заменами строка будет выглядеть следующим образом: <code>&#39;Значение должно быть не менее 8 символов. Значение &quot;банан&quot; не подходит.&#39;</code></p>
<p>Реализовать подобную шаблонизацию достаточно просто с помощью метода строк <code>replace</code>. Чтобы не забивать наш метод <code>validate</code> большим количеством кода, создадим для этого отдельную функцию <code>createMessage</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createMessage = <span class="function"><span class="keyword">function</span>(<span class="params">str, rule, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="string">'%rule%'</span>, rule).replace(<span class="string">'%data%'</span>, data);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Сразу же опробуем функцию</span></span><br><span class="line">createMessage(<span class="string">'Данные: %data%, Правило: %rule%'</span>,<span class="string">'желтый'</span>, <span class="string">'банан'</span>);</span><br><span class="line"><span class="comment">// Данные: банан, Правило: желтый</span></span><br></pre></td></tr></table></figure></p>
<p>Функция работает. Но работает только для наших конкретных переменных. Если в будущем мы захотим передавать и другие значения, то у нас ничего не получится. Чтобы это исправить будем передавать в функцию не отдельные параметры, а объект, содержащий все значения, которые нужно заменить.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createMessage = <span class="function"><span class="keyword">function</span>(<span class="params">str, settings</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> settings) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key, settings[key])</span><br><span class="line">    str = str.replace(<span class="string">'%'</span> + key + <span class="string">'%'</span>, settings[key]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Сразу же опробуем функцию</span></span><br><span class="line">createMessage(<span class="string">'Данные: %data%, Правило: %rule%'</span>, &#123;</span><br><span class="line">  data: <span class="string">'Банан'</span>,</span><br><span class="line">  rule: <span class="string">'Жёлтый'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Данные: банан, Правило: желтый</span></span><br></pre></td></tr></table></figure></p>
<p>Теперь функция принимает неограниченное число значений для замены и не зависит от порядка следования этих значений в объекте. Добавим эту функцию в наш модуль и будем использовать в методе <code>validate</code>.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">fn.validate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// Изначально считаем, что все правила пройдены</span></span><br><span class="line">  <span class="keyword">var</span> isValid = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> rule <span class="keyword">in</span> <span class="keyword">this</span>.rules) &#123;</span><br><span class="line">    <span class="keyword">var</span> param = <span class="keyword">this</span>.rules[rule];</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">this</span>[rule](param);</span><br><span class="line">    <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">      isValid = <span class="literal">false</span>;</span><br><span class="line">      <span class="comment">// Получаем шаблон сообщения из переданного пользователем объекта messages</span></span><br><span class="line">      <span class="keyword">var</span> messageTemplate = <span class="keyword">this</span>.messages[rule];</span><br><span class="line">      <span class="comment">// Создаем сообщение с параметрами data и rule</span></span><br><span class="line">      <span class="keyword">this</span>.message = createMessage(message, &#123;</span><br><span class="line">        data: <span class="keyword">this</span>.value,</span><br><span class="line">        rule: param</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">this</span>.options.onError.call(<span class="keyword">this</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isValid) &#123;</span><br><span class="line">    <span class="keyword">this</span>.options.onSuccess.call(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>Теперь у нас есть сообщение. Но как его можно будет использовать? Как вы, наверное, уже заметили, мы вызываем функции <code>onError</code> и <code>onSuccess</code> с помощью метода <code>call</code>, с помощью которого можно задавать значение <code>this</code> для функций. Другими словами, первый аргумент, передаваемый в метод <code>call</code> будет использован функцией, как <code>this</code>. Таким образом, мы получим возможность использовать все свойства и методы внутри функций.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> onError = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Ошибка: '</span> + <span class="keyword">this</span>.message);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="Обращение-к-прототипу"><a href="#Обращение-к-прототипу" class="headerlink" title="Обращение к прототипу"></a>Обращение к прототипу</h5><p>Чтобы обеспечить удобство создания методов в нашей библиотеке, мы можем экспортировать из нашего модуля не только ссылку на функцию конструктор, но и на её прототип.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Validator = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Validate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> fn = Validate.prototype;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    init: Validate,</span><br><span class="line">    fn: fn</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p>
<p>Теперь для создания новой валидации нам придется использовать следующую конструкцию:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> emailValidation = <span class="keyword">new</span> Validator.init(<span class="comment">/* опции */</span>);</span><br></pre></td></tr></table></figure></p>
<p>Стало немного сложнее, но подобное решение позволяет создавать новые методы для конструктора <code>Validate</code>, обращаясь к его прототипу.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Vaidator.fn.password = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.value === <span class="string">'1234qwerty'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> passwordValidation = <span class="keyword">new</span> Validator.init(<span class="built_in">document</span>.getElementById(<span class="string">'password'</span>), &#123;</span><br><span class="line">  rules: &#123;</span><br><span class="line">    password: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  messages: &#123;</span><br><span class="line">    password: <span class="string">'Пароль %data% неверный'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h5 id="Код-библиотеки-целиком"><a href="#Код-библиотеки-целиком" class="headerlink" title="Код библиотеки целиком"></a>Код библиотеки целиком</h5><p>Вы можете посмотреть результат применения библиотеки на <a href="http://codepen.io/rtivital/pen/JGwaoV" target="_blank" rel="external">codepen</a> или <a href="https://gist.github.com/rtivital/d5499b4b6c8377d79dd2/archive/4484ac046d7daba0adb1caa80632bc39f9305689.zip" target="_blank" rel="external">скачать работающий пример</a>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Validator = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> _createMessage = <span class="function"><span class="keyword">function</span>(<span class="params">message, settings</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> settings) &#123;</span><br><span class="line">      message = message.replace(<span class="string">'%'</span> + key + <span class="string">'%'</span>, settings[key]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> message;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// http://youmightnotneedjquery.com/#deep_extend</span></span><br><span class="line">  <span class="keyword">var</span> _extend = <span class="function"><span class="keyword">function</span>(<span class="params">out</span>) </span>&#123;</span><br><span class="line">    out = out || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> obj = <span class="built_in">arguments</span>[i];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!obj)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">typeof</span> obj[key] === <span class="string">'object'</span>)</span><br><span class="line">            out[key] = _extend(out[key], obj[key]);</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            out[key] = obj[key];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> regExps = &#123;</span><br><span class="line">    email: <span class="regexp">/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]&#123;0,66&#125;)\.([a-z]&#123;2,6&#125;(?:\.[a-z]&#123;2&#125;)?)$/i</span>,</span><br><span class="line">    url: <span class="regexp">/^((https?):\/\/(\w+:&#123;0,1&#125;\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&amp;%@!\-\/]))?$/</span>,</span><br><span class="line">    numbers: <span class="regexp">/^\d+(\.\d&#123;1,2&#125;)?$/</span>,</span><br><span class="line">    digits: <span class="regexp">/[0-9]*$/</span>,</span><br><span class="line">    letters: <span class="regexp">/[a-z][A-Z]*$/</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> messages = &#123;</span><br><span class="line">    required: <span class="string">'This field is required'</span>,</span><br><span class="line">    min: <span class="string">'This field should contain at least %rule% characters'</span>,</span><br><span class="line">    max: <span class="string">'This field should not contain more than %rule% characters'</span>,</span><br><span class="line">    match: <span class="string">'This field shold countain a valid %rule%'</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Validate = <span class="function"><span class="keyword">function</span>(<span class="params">element, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> defaults = &#123;</span><br><span class="line">      regExps: regExps,</span><br><span class="line">      messages: messages</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.options = _extend(&#123;&#125;, defaults, options);</span><br><span class="line">    <span class="keyword">this</span>.element = element;</span><br><span class="line">    <span class="keyword">this</span>.regExps = regExps;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fn = Validate.prototype;</span><br><span class="line"></span><br><span class="line">  fn.validate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> isValid = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.value = <span class="keyword">this</span>.element.value.trim();</span><br><span class="line">    <span class="keyword">this</span>.length = <span class="keyword">this</span>.value.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> rule <span class="keyword">in</span> <span class="keyword">this</span>.options.rules) &#123;</span><br><span class="line">      <span class="keyword">var</span> param = <span class="keyword">this</span>.options.rules[rule];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>[rule](param)) &#123;</span><br><span class="line">        isValid = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.message = _createMessage(<span class="keyword">this</span>.options.messages[rule], &#123;rule: param, data: <span class="keyword">this</span>.value&#125;);</span><br><span class="line">        <span class="keyword">this</span>.options.onError.call(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isValid) &#123;</span><br><span class="line">      <span class="keyword">this</span>.options.onSuccess.call(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  fn.required = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.length &gt; <span class="number">0</span>;&#125;;</span><br><span class="line">  fn.min = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.length &gt;= param; &#125;;</span><br><span class="line">  fn.max = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.length &lt;= param; &#125;;</span><br><span class="line">  fn.match = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.regExps[param].test(<span class="keyword">this</span>.value); &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    init: Validate,</span><br><span class="line">    fn: fn</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>Заметили, каким хитрым образом мы установили объект настроек <code>this.options</code>? Функция <code>_extend</code> широко используется в подобных ситуациях и позволяет переназначить параметры, заданные по умолчанию с помощью объекта настроек.</p>
<h5 id="Что-дальше"><a href="#Что-дальше" class="headerlink" title="Что дальше?"></a>Что дальше?</h5><p>Написанное нами решение небезопасно и недружелюбно к пользователю. Всё из-за того, что мы не включили ни одной обработки ошибок. Представьте, что будет, если пользователь попробует передать в функцию-конструктор <code>Validate</code> DOM элемент, у которого не будет свойства <code>value</code>. Или что случится, когда пользователь попробует воспользоваться несуществующим сообщением об ошибке или же регулярным выражением? Попробуйте сами предусмотреть подобные ситуации и улучшить библиотеку. Вы также можете посмотреть мои в <a href="https://github.com/rtivital/validate" target="_blank" rel="external">этом репозитории</a>.</p>
<p>Если вы хотите ещё попрактиковаться на данном примере, то попробуйте написать следующие методы:</p>
<p>Метод <code>contain</code> проверяет нахождение всех переданных подстрок в проверяемых данных:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> emailValidator = <span class="keyword">new</span> Validator.init(email, &#123;</span><br><span class="line">  rules: &#123;</span><br><span class="line">    contain: [<span class="string">'@'</span>, <span class="string">'.com'</span>, <span class="string">'gmail'</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>Метод <code>only</code> проверяет сотоит ли введённое пользователем значение только из указанных символов:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> phoneValidator = <span class="keyword">new</span> Validator.init(phone, &#123;</span><br><span class="line">  rules: &#123;</span><br><span class="line">    only: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="string">'+'</span>, <span class="string">'-'</span>, <span class="string">'('</span>, <span class="string">')'</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>

      
    </div>

  </div>

  <footer class="article__footer">
    

    
  <div class="article__tags">
    <a class="tag-link" href="/website/tags/JavaScript/">JavaScript</a><a class="tag-link" href="/website/tags/OOP/">OOP</a>
  </div>


  </footer>
  </div>
</article>



    </main>


    <div class="col-3_md-4_sm-12">
      

<aside class="sidebar">
  <a href="/website/" class="logo">
    <img class="logo__image" src="/website/images\new-raccoon-logo.svg" alt="" />
  </a>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/website/categories/Статья/">Статья</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/website/tags/ES6/">ES6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/website/tags/FN/">FN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/website/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/website/tags/OOP/">OOP</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">tagcloud</h3>
    <div class="widget tagcloud">
      <a href="/website/tags/ES6/" style="font-size: 10px;">ES6</a> <a href="/website/tags/FN/" style="font-size: 10px;">FN</a> <a href="/website/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/website/tags/OOP/" style="font-size: 15px;">OOP</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">archive_a</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/website/archives/2016/04/">Апрель 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/website/archives/2016/03/">Март 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget">
    <h3 class="widget__title">Новые публикации</h3>
    <div class="widget__body">
      
        <a class="widget__link" href="/website/fn-array-methods/">Перебирающие методы массивов изнутри</a>
      
        <a class="widget__link" href="/website/oop-objects-vs-primitives/">Объектно-ориентированный JavaScript: примитивы и объекты</a>
      
        <a class="widget__link" href="/website/oop-example-validation/">Объектно-ориентированный JavaScript: немного практики</a>
      
        <a class="widget__link" href="/website/es6-arrow-functions/">ES6: стрелочные функции</a>
      
    </div>
  </div>


  
</aside>

    </div>

  </section>

  <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Vitaly Rtishchev<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  <nav id="mobile-nav">
  
    <a href="/website/" class="mobile-nav-link">Home</a>
  
    <a href="/website/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/website/fancybox/jquery.fancybox.css">
  <script src="/website/fancybox/jquery.fancybox.pack.js"></script>


<script src="/website/js/script.js"></script>

</body>
</html>
